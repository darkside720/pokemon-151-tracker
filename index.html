<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pok√©mon 151 Collection Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      background: url('images/background.jpg') center/cover no-repeat fixed;
      margin: 0; padding: 1rem;
      color: #333; backdrop-filter: brightness(0.8);
    }
    h1, h2 { text-align: center; color: #fff; text-shadow: 2px 2px #000; }
    .controls { text-align: center; margin-bottom: 1rem; }
    #filter { padding: 0.5rem; width: 200px; font-size: 1rem; }
    .pokemon-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem; padding: 0 1rem;
    }
    .pokemon-card {
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      text-align: center;
      transition: transform 0.2s, filter 0.3s;
    }
    .pokemon-card.collected {
      filter: grayscale(80%) contrast(0.7);
    }
    .pokemon-card:hover { transform: scale(1.03); }
    .pokemon-card img {
      width: 100%; max-height: 200px; object-fit: contain;
      border-radius: 8px;
    }
    .pokemon-card select { margin-top: 0.5rem; }
    .meta { font-size: 0.8rem; color: #555; margin-top: 0.5rem; }
    #downloadBtn {
      padding: 0.7rem 1.5rem;
      margin-left: 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Pok√©mon 151 Collection Tracker</h1>

  <div class="section">
    <h2>üî• Top 20 Chase Cards</h2>
    <div class="pokemon-grid" id="chaseCards"></div>
  </div>

  <div class="controls">
    <input type="text" id="filter" placeholder="üîç Filter by name‚Ä¶" />
    <button id="downloadBtn">Download Checklist</button>
  </div>

  <div class="section">
    <h2>All Gen 1 Pok√©mon</h2>
    <div class="pokemon-grid" id="pokemonGrid"></div>
  </div>

  <script>
    const placeholder = "https://via.placeholder.com/150?text=Missing";
    const chaseList = ["charizard","blastoise","venusaur","pikachu","mewtwo","mew",
      "gyarados","zapdos","moltres","articuno","dragonite","alakazam",
      "snorlax","gengar","machamp","raichu","nidoking","clefairy",
      "hitmonchan","chansey"];

    const chaseContainer = document.getElementById("chaseCards");
    const pokemonContainer = document.getElementById("pokemonGrid");

    document.getElementById("filter").addEventListener("input", e => {
      const q = e.target.value.toLowerCase();
      document.querySelectorAll('.pokemon-card').forEach(card => {
        const name = card.querySelector('h3').innerText.toLowerCase();
        card.style.display = name.includes(q) ? '' : 'none';
      });
    });

    document.getElementById("downloadBtn").addEventListener("click", () => {
      const items = [];
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        items.push({
          id: cb.id,
          collected: cb.checked
        });
      });
      const blob = new Blob([JSON.stringify(items, null, 2)], {
        type: 'application/json'
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pokemon-checklist.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    function changeImage(id) {
      const sel = document.getElementById(`select-${id}`);
      const img = document.getElementById(`img-${id}`);
      const card = img.closest('.pokemon-card');
      img.src = card.dataset[sel.value] || placeholder;
    }

    function toggleCollected(id) {
      const cb = document.getElementById(`pokemon-${id}`);
      const card = cb.closest('.pokemon-card');
      card.classList.toggle('collected', cb.checked);
      localStorage.setItem(cb.id, cb.checked);
    }

    function restoreState() {
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        const val = localStorage.getItem(cb.id) === "true";
        cb.checked = val;
        toggleCollected(cb.id.split('-')[1]);
      });
    }

    async function fetchPokemon(id) {
      const r = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
      return await r.json();
    }

    async function fetchTCG(name) {
      try {
        const r = await fetch(`https://api.pokemontcg.io/v2/cards?q=name:"${name}" supertype:"Pok√©mon"&orderBy=-set.releaseDate`);
        const data = await r.json();
        const card = data.data?.[0];
        return {
          image: card?.images?.large || placeholder,
          set: card?.set?.name || 'Unknown',
          year: card?.set?.releaseDate?.split('-')[0] || '?'
        };
      } catch {
        return { image: placeholder, set: 'Unknown', year: '?' };
      }
    }

    async function buildCard(pokeData, tcgInfo, index, container) {
      const name = pokeData.name.charAt(0).toUpperCase() + pokeData.name.slice(1);
      const sprite = pokeData.sprites.front_default || placeholder;
      const artwork = `https://img.pokemondb.net/artwork/large/${pokeData.name}.jpg`;
      const imgUrl = tcgInfo.image;

      const card = document.createElement('div');
      card.className = 'pokemon-card';
      card.dataset.sprite = sprite;
      card.dataset.artwork = artwork;
      card.dataset.tcg = imgUrl;

      card.innerHTML = `
        <h3>#${String(index).padStart(3,'0')} ${name}</h3>
        <img src="${imgUrl}" id="img-${index}" alt="${name}" />
        <select id="select-${index}" onchange="changeImage(${index})">
          <option value="tcg">TCG</option>
          <option value="artwork">Artwork</option>
          <option value="sprite">Sprite</option>
        </select>
        <div class="meta">${tcgInfo.set} (${tcgInfo.year})</div>
        <div><label><input type="checkbox" id="pokemon-${index}" onchange="toggleCollected(${index})"/> Collected</label></div>
      `;

      container.appendChild(card);
    }

    async function loadChase() {
      for (let i = 1; i <= 151; i++) {
        const poke = await fetchPokemon(i);
        if (chaseList.includes(poke.name)) {
          const tcg = await fetchTCG(poke.name);
          await buildCard(poke, tcg, i, chaseContainer);
        }
      }
    }

    async function loadAll() {
      const list = [];
      for (let i = 1; i <= 151; i++) list.push(fetchPokemon(i).then(data => ({id:i, data})));
      const results = await Promise.all(list);
      results.sort((a, b) => a.data.name.localeCompare(b.data.name));
      for (const item of results) {
        const tcg = await fetchTCG(item.data.name);
        await buildCard(item.data, tcg, item.id, pokemonContainer);
      }
      restoreState();
    }

    // Run
    loadChase();
    loadAll();
  </script>
</body>
</html>
