<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PokÃ©mon 151 Collection Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 1rem;
    }
    h1, h2 {
      text-align: center;
    }
    .section {
      margin-bottom: 2rem;
    }
    .pokemon-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
      padding: 0 1rem;
    }
    .pokemon-card {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.2s;
    }
    .pokemon-card:hover {
      transform: scale(1.03);
    }
    .pokemon-card img {
      width: 100%;
      max-height: 200px;
      object-fit: contain;
      border-radius: 8px;
    }
    .pokemon-card select {
      margin-top: 0.5rem;
    }
    .meta {
      font-size: 0.8rem;
      color: #555;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>PokÃ©mon 151 Collection Tracker</h1>

  <!-- Top Chase Cards -->
  <div class="section">
    <h2>ðŸ”¥ Top 20 Chase Cards</h2>
    <div class="pokemon-grid" id="chaseCards"></div>
  </div>

  <!-- Full 151 Sorted -->
  <div class="section">
    <h2>All Gen 1 PokÃ©mon (Sorted Aâ€“Z)</h2>
    <div class="pokemon-grid" id="pokemonGrid"></div>
  </div>

  <script>
    const placeholderImage = "https://via.placeholder.com/150?text=Missing";

    const chaseList = [
      "alakazam", "articuno", "blastoise", "chansey", "charizard", "clefairy", "dragonite",
      "gengar", "gyarados", "hitmonchan", "machamp", "mew", "mewtwo", "moltres", "nidoking",
      "pikachu", "raichu", "snorlax", "venusaur", "zapdos"
    ];

    const chaseContainer = document.getElementById("chaseCards");
    const pokemonContainer = document.getElementById("pokemonGrid");

    async function fetchPokemonDetails(id) {
      const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
      return await res.json();
    }

    async function fetchTCGDetails(name) {
      try {
        const res = await fetch(`https://api.pokemontcg.io/v2/cards?q=name:"${name}" supertype:"PokÃ©mon"&orderBy=-set.releaseDate`);
        const data = await res.json();
        const card = data.data?.[0];
        return {
          image: card?.images?.large || `api/con/${name.toLowerCase()}.jpg`,
          set: card?.set?.name || 'Unknown Set',
          year: card?.set?.releaseDate?.split("-")[0] || "Year?"
        };
      } catch (e) {
        return {
          image: `api/con/${name.toLowerCase()}.jpg`,
          set: 'Unknown Set',
          year: 'Year?'
        };
      }
    }

    async function buildCard(pokeData, tcgInfo, index, targetContainer) {
      const name = pokeData.name.charAt(0).toUpperCase() + pokeData.name.slice(1);
      const sprite = pokeData.sprites.front_default || placeholderImage;
      const artwork = `https://img.pokemondb.net/artwork/large/${pokeData.name}.jpg`;
      const tcg = tcgInfo.image;

      const div = document.createElement("div");
      div.className = "pokemon-card";
      div.dataset.sprite = sprite;
      div.dataset.artwork = artwork;
      div.dataset.tcg = tcg;

      div.innerHTML = `
        <h3>#${String(index).padStart(3, '0')} ${name}</h3>
        <img src="${tcg}" id="img-${index}" alt="${name}" />
        <div class="version-select">
          <label for="select-${index}">Version:</label>
          <select id="select-${index}" onchange="changeImage(${index})">
            <option value="tcg">TCG</option>
            <option value="artwork">Artwork</option>
            <option value="sprite">Sprite</option>
          </select>
        </div>
        <div class="meta">
          ${tcgInfo.set} (${tcgInfo.year})
        </div>
        <div>
          <label>
            <input type="checkbox" id="pokemon-${index}" onchange="toggleCollected(${index})">
            Collected
          </label>
        </div>
      `;

      targetContainer.appendChild(div);
    }

    async function loadChaseCards() {
      for (let i = 1; i <= 151; i++) {
        const poke = await fetchPokemonDetails(i);
        if (chaseList.includes(poke.name)) {
          const tcg = await fetchTCGDetails(poke.name);
          await buildCard(poke, tcg, i, chaseContainer);
        }
      }
    }

    async function loadAllPokemonSorted() {
      const allPokemon = [];

      for (let i = 1; i <= 151; i++) {
        const data = await fetchPokemonDetails(i);
        allPokemon.push({ index: i, data });
      }

      allPokemon.sort((a, b) => a.data.name.localeCompare(b.data.name));

      for (const mon of allPokemon) {
        const tcg = await fetchTCGDetails(mon.data.name);
        await buildCard(mon.data, tcg, mon.index, pokemonContainer);
      }

      restoreState();
    }

    function toggleCollected(id) {
      const key = `pokemon-${id}`;
      const checked = document.getElementById(key).checked;
      localStorage.setItem(key, checked);
    }

    function restoreState() {
      for (let i = 1; i <= 151; i++) {
        const key = `pokemon-${i}`;
        const stored = localStorage.getItem(key);
        if (stored === 'true') {
          const checkbox = document.getElementById(key);
          if (checkbox) checkbox.checked = true;
        }
      }
    }

    function changeImage(id) {
      const select = document.getElementById(`select-${id}`);
      const img = document.getElementById(`img-${id}`);
      const card = img.closest(".pokemon-card");
      const version = select.value;
      img.src = card.dataset[version] || placeholderImage;
    }

    // Load everything
    loadChaseCards();
    loadAllPokemonSorted();
  </script>
</body>
</html>
